<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="description" content="My personal website! Using SvelteKit, it's a place for me to showcase my projects and display my brand. My five cents on tech!" />
    <link rel="icon" type="image/svg+xml" href="../../coin.svg" />
    <link rel="alternate icon" href="../../favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Markdown code highlighting -->
    <link href="/prism.css" rel="stylesheet" />

    <meta http-equiv="content-security-policy" content="">
	<link rel="stylesheet" href="/_app/assets/pages/__layout.svelte-a42667a3.css">
	<link rel="modulepreload" href="/_app/start-5c05493e.js">
	<link rel="modulepreload" href="/_app/chunks/vendor-5cedbe03.js">
	<link rel="modulepreload" href="/_app/chunks/preload-helper-ec9aa979.js">
	<link rel="modulepreload" href="/_app/pages/__layout.svelte-caa24624.js">
	<link rel="modulepreload" href="/_app/pages/blog/posts/__layout.svelte-5b860bad.js">
	<link rel="modulepreload" href="/_app/chunks/card-07d83c98.js">
	<link rel="modulepreload" href="/_app/pages/blog/posts/slack-notifications-with-the-noticed-gem.md-b09a763b.js">
  </head>
  <body>
    <div id="svelte" class="flex flex-1">


<div class="flex-1 flex flex-col"><nav class="flex items-center justify-between flex-wrap bg-sky-500 p-4 shadow-lg shadow-black"><a href="/" class="flex items-center flex-shrink-0 mr-6"><img class="h-8 w-8 mr-2" src="/coin.svg" alt="The Technickel logo, a 5 cent Canadian coin (nickel)">
    <span class="font-bold text-2xl tracking-tight text-white">TECHNICKEL</span></a>
  <div class="block sm:hidden"><button class="flex items-center px-3 py-2 rounded text-sky-200 border-sky-400 hover:text-white hover:border-white"><svg class="fill-current h-6 w-6" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Menu</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path></svg></button></div>
  <div class="w-full flex-grow sm:flex sm:items-center sm:w-auto"><div class="text-sm sm:flex-grow"><a href="/blog" class="mt-4 hidden sm:inline-block sm:mt-0 text-sky-200 hover:text-white mr-4">Blog</a>
      <a href="/projects" class="mt-4 hidden sm:inline-block sm:mt-0 text-sky-200 hover:text-white mr-4">Projects</a>
      <a href="/contact" class="mt-4 hidden sm:inline-block sm:mt-0 text-sky-200 hover:text-white mr-4">Contact</a>
      <a href="/support" class="mt-4 hidden sm:inline-block sm:mt-0 text-sky-200 hover:text-white mr-4">Support</a></div></div></nav>
  <div class="flex-1 flex p-4 md:p-8 justify-center"><div class="flex flex-col justify-center"><div class="flex justify-center mb-4"><a class="btn m-auto" href="/blog">Back to Blogs</a></div>
  <div class="p-4 rounded overflow-hidden shadow-lg bg-neutral-600 px-4 md:px-16 py-8"><article class="prose prose-invert"><h1>Slack Notifications with the Noticed Gem</h1>
<p>2022-02-17 - Bradley Leonard</p>
<h2>Introduction</h2>
<p>Notification systems are essential in user based applications in order to convey important information to your users when they are in or out of the application. This blog post will make use of the <a href="https://api.slack.com/messaging/managing" rel="nofollow">Slack API</a> and the <a href="https://github.com/excid3/noticed" rel="nofollow">Noticed</a> gem to show you how you can send a Slack notification from your app and get that important information to your users in their favorite messaging program, Slack!</p>
<p>Our example is going to use the role of a ticketing system notification, but your use case could be any type of notification!</p>
<h2>What is Noticed?</h2>
<p>Noticed is an open source Ruby gem built by Rails aficionado excid3 <a href="https://twitter.com/excid3" rel="nofollow">(Chris Oliver)</a>. It makes it SUPER easy to work with a number of different communication methods to send notifications to your users / systems. Some of these methods include:</p>
<ul><li>Database</li>
<li>Email</li>
<li>ActionCable channels</li>
<li>Slack</li>
<li>Microsoft Teams</li>
<li>Twilio (SMS)</li>
<li>Vonage / Nexmo (SMS)</li>
<li>iOS Apple Push Notifications</li>
<li>Firebase Cloud Messaging (Android and more)</li>
<li>Your own custom method!</li></ul>
<p>If you aren’t already familiar with the basics of Noticed, you can watch this <a href="https://youtu.be/Scffi4otlFc" rel="nofollow">screencast</a> to get your feet wet.</p>
<h2>The code</h2>
<p>Here is all the code your going to need to send off a Slack message notification! Keep in mind the <a href="https://github.com/excid3/noticed#-installation" rel="nofollow">Noticed gem needs to be setup</a> and you need to <a href="https://api.slack.com/messaging/webhooks#create_a_webhook" rel="nofollow">generate a webhook for Slack</a> before any of this will work. Let’s break it down piece by piece.</p>
<pre class="language-ruby"><!-- HTML_TAG_START --><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">TicketClosedNotification</span> <span class="token operator">&lt;</span> Noticed<span class="token double-colon punctuation">::</span>Base
  deliver_by <span class="token symbol">:database</span>
  deliver_by <span class="token symbol">:slack</span><span class="token punctuation">,</span> <span class="token symbol">url</span><span class="token operator">:</span> <span class="token symbol">:webhook_url</span><span class="token punctuation">,</span> <span class="token symbol">format</span><span class="token operator">:</span> <span class="token symbol">:to_slack</span>

  <span class="token comment"># Add required params</span>
  param <span class="token symbol">:ticket</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">to_slack</span></span>
    <span class="token punctuation">&#123;</span>
      <span class="token symbol">text</span><span class="token operator">:</span> slack_message
    <span class="token punctuation">&#125;</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">message</span></span>
    <span class="token string-literal"><span class="token string">"Ticket </span><span class="token interpolation"><span class="token delimiter punctuation">#&#123;</span><span class="token content">params<span class="token punctuation">[</span><span class="token symbol">:ticket</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id</span><span class="token delimiter punctuation">&#125;</span></span><span class="token string"> was closed"</span></span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">slack_message</span></span>
    <span class="token string-literal"><span class="token string">"#&lt;</span><span class="token interpolation"><span class="token delimiter punctuation">#&#123;</span><span class="token content">url_for<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:ticket</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">&#125;</span></span><span class="token string">|Ticket </span><span class="token interpolation"><span class="token delimiter punctuation">#&#123;</span><span class="token content">params<span class="token punctuation">[</span><span class="token symbol">:ticket</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id</span><span class="token delimiter punctuation">&#125;</span></span><span class="token string">> closed by </span><span class="token interpolation"><span class="token delimiter punctuation">#&#123;</span><span class="token content">SlackService<span class="token double-colon punctuation">::</span>slack_or_name<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:ticket</span><span class="token punctuation">]</span><span class="token punctuation">.</span>owner<span class="token punctuation">)</span></span><span class="token delimiter punctuation">&#125;</span></span><span class="token string">"</span></span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">url</span></span>
    ticket_path<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:ticket</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">webhook_url</span></span>
    <span class="token comment"># THIS PRACTICE IS DANGEROUS AND JUST FOR DEMONSTRATION PURPOSES</span>
    <span class="token comment"># A Slack webhook has a secret in it and should not be directly commited to a public repository</span>
    <span class="token comment"># Slack monitors for leaked webhooks and will revoke yours if it finds it</span>
    <span class="token comment"># A better practice is to use environment variables or Rails credentials / secrets</span>
    <span class="token string-literal"><span class="token string">"https://hooks.slack.com/services/XXXXXXXXX/XXXXXXXXXXX/XXXXXXXXXXXXXXXXXXXXXXXX"</span></span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code><!-- HTML_TAG_END --></pre>
<h3>class TicketClosedNotification ≤ Noticed::Base</h3>
<p>This line is very important and tells Noticed to work with this class as a notification. It’s the base building block that everything else will be built off of.</p>
<h3>deliver_by :database</h3>
<p>This is the standard delivery method for in-app notifications. An entry in the database will be made for recipients of the notification. This isn’t as relevant to the Slack portion of things, but important none the less.</p>
<h3>deliver_by :slack, url: :webhook_url, format: :to_slack</h3>
<p>Probably the most important line in the file, this tells Noticed how we are going to deliver our slack message. We pass both a url and format option that will be talked about later. The thing to know right now is what each option does and that both options have defaults if you leave them out.</p>
<p>The url option tells Noticed where to make the HTTP call so that we can work with the Slack API. This will default to a Rails credential if not overriden.</p>
<p>The format option tells Noticed in what format to send the request. By default this will send the notification parameters (in our example params[:ticket]) but Slack doesn’t know what to do with the information in that format so we supplied our own options which we will talk about in a bit.</p>
<h3>param :ticket</h3>
<p>This line tells the notification that it REQUIRES a ticket to work. Without including a ticket in the options, the notification will fail to send with an error. This allows us to make use of the ticket object to make dynamic messages and routes.</p>
<h3>to_slack</h3>
<p>We use this method to format the payload that we send to Slack. We are going to keep things simple and only take advantage of the text options that you can send to Slack, but the API is super powerful and you can take advantage of <a href="https://api.slack.com/messaging/webhooks#advanced_message_formatting" rel="nofollow">a number of different formatting options</a>. In this method we make a hash with the text attribute being filled in by the “slack_message” method that we will talk about later. When this is sent to slack, whatever is in the text is the message that will display in the Slack channel.</p>
<h3>message</h3>
<p>This method is setting the message for the database delivery method. While useful for in-app notifications, since we are focusing on Slack, this is not overly important.</p>
<h3>slack_message</h3>
<p>I used this method to build the string that is passed to the text object that we send to Slack. When all said and done it looks something like “Ticket 1 closed by Technickel”. There are a few things to note about the way this string is formatted.</p>
<p>The below code takes the url on the left and the text on the right. Slack interprets this as a link that shows the text only and takes you to the url when clicked on.</p>
<pre class="language-html"><!-- HTML_TAG_START --><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url|text</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url|text</span><span class="token punctuation">></span></span></code><!-- HTML_TAG_END --></pre>
<p>The second thing of note is the method. This is a custom method for our application to ping or @ the user on Slack when a ticket pertains to them. We have a user store their Slack user ID (looks something like @XXXXXXXXXXX) on their profile and then we can reference ping them directly from the message. If the user doesn’t have their Slack user ID, we just use their name instead.</p>
<pre class="language-ruby"><!-- HTML_TAG_START --><code class="language-ruby">SlackService<span class="token double-colon punctuation">::</span>slack_or_name<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:ticket</span><span class="token punctuation">]</span><span class="token punctuation">.</span>owner<span class="token punctuation">)</span></code><!-- HTML_TAG_END --></pre>
<h3>url</h3>
<p>This section isn’t really used for Slack notification purposes and is mainly for the database delivery method. We’ll ignore it for this tutorial, but it usually sets the path you can use to link to in an in-app notification.</p>
<h3>webhook_url</h3>
<p>By default the webhook url that Noticed uses is the following:</p>
<pre class="language-ruby"><!-- HTML_TAG_START --><code class="language-ruby">Rails<span class="token punctuation">.</span>application<span class="token punctuation">.</span>credentials<span class="token punctuation">.</span>slack<span class="token punctuation">[</span><span class="token symbol">:notification_url</span><span class="token punctuation">]</span></code><!-- HTML_TAG_END --></pre>
<p>If you only need to use one webhook, you can stick with this default and remove the <em>url: :webhook_url</em> option. For applications that require more than one webhook, you can point the url option to a method. In our case, we use the webhook_url method to return the Slack webhook as a string. This webhook string should look similar to the one in the code, with a unique value replacing the Xs that slack uses to know to reference your Slack.</p>
<p>NOTE: It is VERY important not to put the webhook string straight into your code, especially if your source code is public. A Slack webhook has a secret in it and should not be directly commited to a public repository as other people can maliciously use it. Slack monitors for leaked webhooks and will revoke yours if it finds it, therefore a better practice is to use environment variables or Rails credentials / secrets and then reference those in the method.</p>
<h2>Recap</h2>
<p>That’s it! Now all you have to do is <a href="https://github.com/excid3/noticed#-usage" rel="nofollow">call the notification using the normal calling methods</a> in the gem. With Noticed, it’s super simple to setup slack notifications! It’s also super convenient that Noticed handles all your other types of notification such as in-app, email, SMS, etc… so that your communication code can all live organized in one place. All in all, a fantastic addition to any Rails application.</p></article></div>
  <div class="flex justify-center mt-4"><a class="btn m-auto" href="/blog">Back to Blogs</a></div></div></div></div>


		<script type="module" data-hydrate="a22yvm">
		import { start } from "/_app/start-5c05493e.js";
		start({
			target: document.querySelector('[data-hydrate="a22yvm"]').parentNode,
			paths: {"base":"","assets":""},
			session: {},
			route: true,
			spa: false,
			trailing_slash: "never",
			hydrate: {
				status: 200,
				error: null,
				nodes: [
					import("/_app/pages/__layout.svelte-caa24624.js"),
						import("/_app/pages/blog/posts/__layout.svelte-5b860bad.js"),
						import("/_app/pages/blog/posts/slack-notifications-with-the-noticed-gem.md-b09a763b.js")
				],
				url: new URL("http://sveltekit-prerender/blog/posts/slack-notifications-with-the-noticed-gem"),
				params: {}
			}
		});
	</script></div>
  </body>
</html>
